class kdQuiz{constructor(e,t,n){this.questionsData=e,this.styleName=t,this.currentQuestionIndex=0,this.correctAnswersCount=0,this.containerElement=n,this.quizElement=null,this.cardFront=null,this.cardBack=null,this.createQuizElement(),this.loadQuestion()}createMeta(e,t,n){const i=document.createElement("meta");i.setAttribute("itemprop",t),i.content=n,e.appendChild(i)}createQuizElement(){this.quizElement=document.createElement("div"),this.quizElement.className="kd-quiz-card "+this.styleName,this.quizElement.setAttribute("itemscope",""),this.quizElement.setAttribute("itemtype","http://schema.org/SoftwareApplication"),this.createMeta(this.quizElement,"name","Interactive Quiz"),this.createMeta(this.quizElement,"description","Allows you to create a simple interactive quiz on any page or post, requires Wordpress"),this.createMeta(this.quizElement,"softwareVersion","1.0.0"),this.createMeta(this.quizElement,"operatingSystem","Web/Wordpress");const e=document.createElement("div");e.setAttribute("itemprop","author"),e.setAttribute("itemscope",""),e.setAttribute("itemtype","http://schema.org/Person"),this.createMeta(e,"name","Nikos Konstas");const t=document.createElement("link");t.setAttribute("itemprop","url"),t.href="https://github.com/nkonstas/wordpress-quiz",e.appendChild(t),this.quizElement.appendChild(e),this.cardInner=document.createElement("div"),this.cardInner.className="kd-card-inner",this.cardFront=this.createCardFace("front"),this.cardBack=this.createCardFace("back"),this.cardInner.appendChild(this.cardFront),this.cardInner.appendChild(this.cardBack),this.quizElement.appendChild(this.cardInner),this.containerElement.appendChild(this.quizElement)}createCardFace(e){const t=document.createElement("div");return t.className=`kd-card-face kd-card-${e}`,t}loadQuestion(){this.questionData=this.questionsData[this.currentQuestionIndex],this.updateFrontFace(),this.quizElement.classList.remove("kd-flipped"),this.recordViewedQuestion(this.questionData.questionId),this.incrementQuestionViewCount(this.questionData.questionId)}recordViewedQuestion(e){if(!e)return;const t=JSON.parse(localStorage.getItem("viewedQuestions"))||[];if(!t.includes(e)){t.push(e);const n=10;t.length>n&&t.splice(0,t.length-n),localStorage.setItem("viewedQuestions",JSON.stringify(t))}}incrementQuestionViewCount(e){fetch(kdQuizAjax.ajax_url,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"kd_increment_view_count",nonce:kdQuizAjax.nonce,question_id:e})}).then((e=>e.json())).then((e=>{e.success})).catch((e=>{}))}recordQuizAnswer(e,t){fetch(kdQuizAjax.ajax_url,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"kd_record_answer",nonce:kdQuizAjax.nonce,question_id:e,is_correct:t})}).then((e=>e.json())).then((e=>{e.success})).catch((e=>{}))}updateFrontFace(){this.cardFront.innerHTML="";const e=document.createElement("p");e.className="kd-question",e.textContent=this.questionData.questionText;const t=document.createElement("ul");t.className="kd-options",this.questionData.options.forEach(((e,n)=>{const i=document.createElement("li");i.className="kd-option",i.textContent=e.optionText,t.appendChild(i),i.addEventListener("click",(()=>{this.isAnswerCorrect=this.questionData.correctOptionId===this.questionData.options[n].optionId,this.isAnswerCorrect&&this.correctAnswersCount++,this.updateBackFace(),this.quizElement.classList.add("kd-flipped"),this.recordQuizAnswer(this.questionData.questionId,this.isAnswerCorrect)}))})),this.cardFront.appendChild(e),this.cardFront.appendChild(t)}updateBackFace(){this.showAnswerExplanation(),this.showNextButton()}showAnswerExplanation(){const e=this.quizElement.querySelector(".kd-card-back");e.innerHTML="";const t=document.createElement("p");t.className=this.isAnswerCorrect?"kd-correct":"kd-incorrect",t.innerHTML=this.isAnswerCorrect?'<span class="kd-answer-icon"></span>'+kdQuizAjax.text_correct_answer:'<span class="kd-answer-icon"></span>'+kdQuizAjax.text_wrong_answer;const n=document.createElement("p");n.className="kd-answer",n.textContent=this.questionData.explanation,e.appendChild(t),e.appendChild(n)}showNextButton(){const e=document.createElement("button");e.className="kd-action",this.currentQuestionIndex<this.questionsData.length-1?(e.textContent=kdQuizAjax.text_next_question_raw,e.addEventListener("click",(()=>{this.currentQuestionIndex++,this.loadQuestion(),this.quizElement.classList.remove("kd-flipped")}))):(e.textContent=kdQuizAjax.text_next_view_score_raw,e.addEventListener("click",(()=>{this.displayFinalScore(this.correctAnswersCount,this.questionsData.length),this.quizElement.classList.remove("kd-flipped")})));this.quizElement.querySelector(".kd-card-back").appendChild(e)}getGrade(e){return e>=90?"A":e>=70?"B":e>=50?"C":"F"}displayFinalScore(e,t){const n=e/t*100;let i,s,a;switch(this.getGrade(n)){case"A":i="kd-final-a",s=kdQuizAjax.kd_quiz_text_score_grade_a,a=kdQuizAjax.kd_quiz_text_score_grade_a_message;break;case"B":i="kd-final-b",s=kdQuizAjax.kd_quiz_text_score_grade_b,a=kdQuizAjax.kd_quiz_text_score_grade_b_message;break;default:case"C":i="kd-final-c",s=kdQuizAjax.kd_quiz_text_score_grade_c,a=kdQuizAjax.kd_quiz_text_score_grade_c_message;break;case"F":i="kd-final-f",s=kdQuizAjax.kd_quiz_text_score_grade_f,a=kdQuizAjax.kd_quiz_text_score_grade_f_message;break}this.cardFront.innerHTML=`\n        <div class="${i}">\n        <p class="kd-final-grade">${kdQuizAjax.kd_quiz_text_score_grade} <span>${s}</span></p>\n        <p class="kd-final-score">${kdQuizAjax.kd_quiz_text_score_percentage} ${n.toFixed(0)}%</p>\n        <p class="kd-final-message">${a}</p>\n        </div>`}}class kdQuizMgr{constructor(){this.init()}init(){document.addEventListener("DOMContentLoaded",(()=>{const e=document.querySelectorAll(kdQuizAjax.element_selector);if(0===e.length&&kdQuizAjax.auto_insert_enabled){const e=window.innerHeight*(kdQuizAjax.min_distance/100),t=document.querySelectorAll(kdQuizAjax.heading_selector),n=kdQuizAjax.heading_match.trim();let i=null;if(n){const e=n.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&").replace(/\*/g,".*");i=new RegExp(e,"i")}for(let n of t){if(n.getBoundingClientRect().top+window.scrollY>=e&&(!i||i.test(n.textContent))){const e=document.createElement("div");e.id=kdQuizAjax.element_selector.replace("#",""),n.parentNode.insertBefore(e,n),this.fetchQuestionsAndCreateQuiz(e);break}}}else e.length>0&&this.fetchQuestionsAndCreateQuiz(e[0])}))}fetchQuestionsAndCreateQuiz(e){const t=localStorage.getItem("viewedQuestions")||"[]";fetch(kdQuizAjax.ajax_url,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"kd_fetch_random_questions",number:kdQuizAjax.questions,nonce:kdQuizAjax.nonce,viewed_questions:t})}).then((e=>e.json())).then((t=>{if(t.success){new kdQuiz(t.data,kdQuizAjax.style,e)}})).catch((e=>{}))}}const manager=new kdQuizMgr;